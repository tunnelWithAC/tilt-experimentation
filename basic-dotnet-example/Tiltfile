docker_build('hello-tilt', './hello-tilt')
# k8s_yaml(kustomize('overlays/port'))
k8s_yaml('k8s/deployment.yaml')
k8s_resource('hello-tilt', port_forwards='8080:8080')

local_resource(
    'smoke-test-weatherforecast',
    '''
    for i in $(seq 1 30); do
      curl --fail http://localhost:8080/weatherforecast && exit 0
      echo "Waiting for service... ($i/30)"
      sleep 7
    done
    echo "Service did not become ready in time" >&2
    exit 1
    ''',
    deps=['hello-tilt'],
)
